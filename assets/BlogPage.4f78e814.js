import{G as b,u as g,a as B,r as e,R as P,b as w,L,c as R}from"./index.b47de396.js";import{c as f,a as v,F as C,b as N}from"./formik.esm.5b541d60.js";const $="_blog_ncjih_1",S="_edit_ncjih_29",T="_buttons_ncjih_51",z="_icon_ncjih_61";var _={blog:$,edit:S,buttons:T,icon:z};const j="_icon_dftfj_1";var D={icon:j};function k(t){return b({tag:"svg",attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M360 184h-8c4.4 0 8-3.6 8-8v8h304v-8c0 4.4 3.6 8 8 8h-8v72h72v-80c0-35.3-28.7-64-64-64H352c-35.3 0-64 28.7-64 64v80h72v-72zm504 72H160c-17.7 0-32 14.3-32 32v32c0 4.4 3.6 8 8 8h60.4l24.7 523c1.6 34.1 29.8 61 63.9 61h454c34.2 0 62.3-26.8 63.9-61l24.7-523H888c4.4 0 8-3.6 8-8v-32c0-17.7-14.3-32-32-32zM731.3 840H292.7l-24.2-512h487l-24.2 512z"}}]})(t)}function F(t){const a=g(c=>c.user.token),s=B(),m=t.id,l=async()=>{try{const c=await fetch(`${{}.REACT_APP_BACKEND_URL}/user/${m}`,{method:"DELETE",headers:{authorization:`BEARER ${a}`}});if(s(-1),!c.ok)throw new Error("Could not delete blog page")}catch(c){console.log(c)}};return e.exports.createElement(k,{size:"30px",color:"red",className:D.icon,onClick:l})}const I="_error_1p36k_1",H="_form_1p36k_9";var x={error:I,form:H};function M(t){const[a,s]=e.exports.useState(!1),m=g(o=>o.user.token),l=async o=>{try{if(!(await fetch({}.REACT_APP_BACKEND_URL+`/blogs/comment/${t.blogId}`,{method:"POST",body:JSON.stringify({comment:o.comment}),headers:{"Content-Type":"application/json",authorization:`BEARER ${m}`}})).ok)throw new Error("Could not create new comment");t.toggler()}catch(r){console.log(r)}},c=f().shape({comment:v().required("Your comment is empty!")});return e.exports.createElement("section",{className:x.form},e.exports.createElement(C,{initialValues:{comment:""},validationSchema:c,validateOnChange:!1,validateOnBlur:!1,onSubmit:o=>{l(o),s(!0),setTimeout(()=>{s(!1)},3e3)}},({errors:o,handleBlur:r,handleChange:i,values:u})=>e.exports.createElement(N,null,e.exports.createElement("label",{htmlFor:"comment"}," Add a Comment"),e.exports.createElement("textarea",{name:"comment",onChange:i,onBlur:r,value:u.comment}),o.comment&&e.exports.createElement("div",{className:x.error},o.comment),e.exports.createElement("button",{className:"btn",type:"submit",disabled:a},"Comment"))))}const O="_item_jxtt1_1",U="_user_jxtt1_13",K="_span_jxtt1_41",V="_icon_jxtt1_47";var d={item:O,user:U,span:K,icon:V},q="/myblog/assets/user-img.71898c51.png";function y(t){return b({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{d:"M4 21a1 1 0 0 0 .24 0l4-1a1 1 0 0 0 .47-.26L21 7.41a2 2 0 0 0 0-2.82L19.42 3a2 2 0 0 0-2.83 0L4.3 15.29a1.06 1.06 0 0 0-.27.47l-1 4A1 1 0 0 0 3.76 21 1 1 0 0 0 4 21zM18 4.41 19.59 6 18 7.59 16.42 6zM5.91 16.51 15 7.41 16.59 9l-9.1 9.1-2.11.52z"}}]})(t)}function G(t){const[a,s]=e.exports.useState(!1),m=g(o=>o.user.token),l=async o=>{try{if(!(await fetch({}.REACT_APP_BACKEND_URL+`/blogs/comment/${t.commentId}`,{method:"PATCH",body:JSON.stringify({comment:o.comment}),headers:{"Content-Type":"application/json",authorization:`BEARER ${m}`}})).ok)throw new Error("Could not update comment");t.editToggle(),t.toggler()}catch(r){console.log(r)}},c=f().shape({comment:v().required("Your comment is empty!")});return e.exports.createElement("section",{className:x.form},e.exports.createElement(C,{initialValues:{comment:t.comment},validationSchema:c,validateOnChange:!1,validateOnBlur:!1,onSubmit:o=>{l(o),s(!0),setTimeout(()=>{s(!1)},3e3)}},({errors:o,handleBlur:r,handleChange:i,values:u})=>e.exports.createElement(N,null,e.exports.createElement("label",{htmlFor:"comment"}," Edit Comment"),e.exports.createElement("textarea",{name:"comment",onChange:i,onBlur:r,value:u.comment}),o.comment&&e.exports.createElement("div",{className:x.error},o.comment),e.exports.createElement("button",{className:"btn",type:"submit",disabled:a},"Comment"))))}function J(t){const a=g(n=>n.user.token),m=g(n=>n.user.id)===t.comment.user._id,[l,c]=e.exports.useState(!1);function o(n){return n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()}const r=()=>{c(n=>!n)},i=async()=>{try{if(!(await fetch(`${{}.REACT_APP_BACKEND_URL}/blogs/comment/${t.comment._id}`,{method:"DELETE",headers:{authorization:`BEARER ${a}`}})).ok)throw new Error("Could not delete comment");t.toggler()}catch(n){console.log(n)}},u=new Date(t.comment.date).toLocaleString();return e.exports.createElement("div",{className:d.item},e.exports.createElement("div",{className:d.user},e.exports.createElement("img",{src:q,alt:"Icon"}),e.exports.createElement("h3",null,o(t.comment.user.firstName)+" "+o(t.comment.user.lastName)+" ",e.exports.createElement("span",{className:d.span},u),e.exports.createElement("span",null,m&&e.exports.createElement(e.exports.Fragment,null,e.exports.createElement(y,{size:"20px",color:"grey",className:d.icon,onClick:r}),e.exports.createElement(k,{size:"20px",color:"grey",className:d.icon,onClick:i}))))),l?e.exports.createElement(G,{commentId:t.comment._id,comment:t.comment.content,toggler:t.toggler,editToggle:r}):e.exports.createElement("p",null,t.comment.content))}const Y="_comments_1r48b_1",Q="_btn_1r48b_13",W="_container_1r48b_15",X="_active_1r48b_59";var p={comments:Y,btn:Q,container:W,active:X};function Z(t){const{comments:a}=t,s=g(n=>n.user.token),[m,l]=e.exports.useState(0),c=5,o=m*c,r=a.length?a.length:1,i=Math.ceil(r/c),u=({selected:n})=>{l(n)};return e.exports.createElement("div",{className:p.comments},e.exports.createElement("h2",null,"Comments"),s?e.exports.createElement(M,{blogId:t.blogId,toggler:t.toggler}):e.exports.createElement("h3",null,"Login to comment"),a&&e.exports.createElement(e.exports.Fragment,null,a.slice(o,o+c).map(n=>e.exports.createElement(J,{comment:n,key:n._id,toggler:t.toggler})),e.exports.createElement(P,{previousLabel:"Previous",nextLabel:"Next",pageCount:i,onPageChange:u,containerClassName:p.container,previousLinkClassName:p.btn,nextLinkClassName:p.btn,activeClassName:p.active})))}const oe=()=>{const t=w(),{id:a}=t,[s,m]=e.exports.useState(null),l=g(E=>E.user),[c,o]=e.exports.useState(!1),r=()=>{o(E=>!E)};e.exports.useEffect(()=>{(async()=>{try{const h=await fetch(`${{}.REACT_APP_BACKEND_URL}/blogs/blog/${a}`);if(!h.ok)throw new Error("Could not fetch blog page");const A=await h.json();m(A.blog)}catch(h){console.log(h)}})()},[a,c]);const i=e.exports.createElement("div",{className:_.buttons},e.exports.createElement(L,{to:`/edit/${a}`},e.exports.createElement(y,{className:_.icon,size:"30px"})),e.exports.createElement(F,{id:a})),u=!!s;let n=!1;return!!l.token&&s&&(n=s.author._id===l.id),e.exports.createElement(e.exports.Fragment,null,u?e.exports.createElement(e.exports.Fragment,null,e.exports.createElement("div",{className:_.blog},e.exports.createElement("h1",null,s.title),e.exports.createElement("h2",null,s.author.firstName+" "+s.author.lastName," "),e.exports.createElement("h3",null,s.description),n&&i,e.exports.createElement("p",null,s.article)),e.exports.createElement(Z,{blogId:a,comments:s.comments,toggler:r})):e.exports.createElement(R,null))};export{oe as default};
